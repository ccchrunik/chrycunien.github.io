# Demo - Nginx

We create a custom helm chart in this note.

```bash
# Make our working directory consistent
$ mkdir ~/helm-demo
$ cd ~/helm-demo
```

## Create Template
```bash
# Create a template
$ helm create cloudacademy-webapp

# Investigate diretory structure
$ tree cloudacademy-webapp

$ cd cloudacademy-webpp

# Remove all existing templae
$ rm -rf ctemplates/*
```

## Add templates
Replace files in this chart by this [repo](https://github.com/cloudacademy/helm-demo)

## Run
```bash
# Lint the chart
$ helm lint .

# Look the result generated by the template engine
$ helm template . 

$ cd ../
$ helm package cloudacademy-webapp

# Create namespace cloudacademy
$ kubectl create ns cloudacademy
# Set the default namespace to cloudacademy
$ kubectl config set-context --current --namespace cloudacademy

# Run this command to test 
# Create a temporary busybox image for test
$ kubectl run --image=busybox bbox1 --restart=Never -it --rm -- /bin/sh -c "wget -qO- http://10.98.78.214"
# Result:
# CloudAcademy DevOps 2020 v1

# Upgrade the nginx message
$ helm upgrade ca-demo1 cloudacademy-webapp-0.1.0.tgz --set nginx.conf.message='Helm Rocks!'

# Run this command again to see the change
$ kubectl run --image=busybox bbox1 --restart=Never -it --rm -- /bin/sh -c "wget -qO- http://10.98.78.214"

# See the history
$ helm history ca-demo1
# Or
$ kubectl rollout history deployment ca-demo1-cloudacademy-webapp 

# Create the index
$ helm repo index .
```

## Serving using github pages
You can follow the last course in this [link](https://cloudacademy.com/course/introduction-to-helm-1034) to comlete this task.

## References
- https://cloudacademy.com/course/introduction-to-helm-1034
- https://github.com/cloudacademy/helm-demo