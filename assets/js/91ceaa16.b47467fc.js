(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[154],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return s},kt:function(){return d}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),m=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},s=function(e){var n=m(e.components);return a.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),c=m(t),d=r,k=c["".concat(p,".").concat(d)]||c[d]||u[d]||l;return t?a.createElement(k,i(i({ref:n},s),{},{components:t})):a.createElement(k,i({ref:n},s))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=c;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var m=2;m<l;m++)i[m]=t[m];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},5869:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return m},toc:function(){return s},default:function(){return c}});var a=t(2122),r=t(9756),l=(t(7294),t(3905)),i=["components"],o={},p="Overview",m={unversionedId:"Docker/Compose/Overview",id:"Docker/Compose/Overview",isDocsHomePage:!1,title:"Overview",description:"- Docker Compose simplify the deployment of docker containers.",source:"@site/docs/Docker/Compose/Overview.md",sourceDirName:"Docker/Compose",slug:"/Docker/Compose/Overview",permalink:"/docs/Docker/Compose/Overview",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Multiple Compose Files",permalink:"/docs/Docker/Compose/Multiple"},next:{title:"Deploy Wordpress",permalink:"/docs/Docker/Compose/Wordpress-Example"}},s=[{value:"Compose File",id:"compose-file",children:[{value:"Version",id:"version",children:[]},{value:"Services",id:"services",children:[]},{value:"Volumes",id:"volumes",children:[]},{value:"Networks",id:"networks",children:[]},{value:"Varialb Substitution",id:"varialb-substitution",children:[]},{value:"Extension Fields",id:"extension-fields",children:[]}]},{value:"CLI",id:"cli",children:[{value:"Usage",id:"usage",children:[]},{value:"Commands",id:"commands",children:[]}]},{value:"References",id:"references",children:[]}],u={toc:s};function c(e){var n=e.components,t=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"overview"},"Overview"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Docker Compose simplify the deployment of docker containers."),(0,l.kt)("li",{parentName:"ul"},"Declarative instead of imperative."),(0,l.kt)("li",{parentName:"ul"},"Template")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"version: ...\nservices: \n  ...\nvolumes:\n  ...\nnetworks:\n  ...\n")),(0,l.kt)("h2",{id:"compose-file"},"Compose File"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Some configuration may only apply to swarm mode"),(0,l.kt)("li",{parentName:"ul"},"Some options are specified in the CLI")),(0,l.kt)("h3",{id:"version"},"Version"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"A string like ",(0,l.kt)("inlineCode",{parentName:"li"},"'3'"),"."),(0,l.kt)("li",{parentName:"ul"},"Can conlude minor version like ",(0,l.kt)("inlineCode",{parentName:"li"},"'3.4'")),(0,l.kt)("li",{parentName:"ul"},"If left unspecified, the default is ",(0,l.kt)("inlineCode",{parentName:"li"},"'3.0'")),(0,l.kt)("li",{parentName:"ul"},"This define how to interpret the compose file")),(0,l.kt)("h3",{id:"services"},"Services"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Services in your applications"),(0,l.kt)("li",{parentName:"ul"},"Nested Mapping"),(0,l.kt)("li",{parentName:"ul"},"Specify name for each container."),(0,l.kt)("li",{parentName:"ul"},"Example:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  webapp:\n    image: app\n    ports:\n    - "5000:5000"\n    depends_on:\n    - redis\n  redis:\n    image: redis\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Explanation"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"webapp"),": name of the container"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"image"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"image for the container"),(0,l.kt)("li",{parentName:"ul"},"if you want to build on the fly, use ",(0,l.kt)("inlineCode",{parentName:"li"},"build:")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"build"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"context"),": the directory of the app"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"dockerfile"),": alternative of the dockerfile"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"args"),": the arguments for build"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.docker.com/compose/compose-file/compose-file-v3/"},"https://docs.docker.com/compose/compose-file/compose-file-v3/")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ports"),": a sequence of port mapping string"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"depends_on"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Dependency for other containers"),(0,l.kt)("li",{parentName:"ul"},"However, it still has no guarantee whether that container is ready for use, in this case, use some scripts to delay the initialization."))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Others options"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-e, --env")," => ",(0,l.kt)("inlineCode",{parentName:"li"},"environment")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-v, --volume, --mount")," => ",(0,l.kt)("inlineCode",{parentName:"li"},"volumes")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-p")," => ",(0,l.kt)("inlineCode",{parentName:"li"},"ports")),(0,l.kt)("li",{parentName:"ul"},"... "))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Another Examples: ",(0,l.kt)("inlineCode",{parentName:"p"},"docker run --name app-cache -p 6379:6379 redis:4.0.6 redis-server --appendonly yes")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'version: \'3\'\nservices:\n  app-cache:\n    image: redis:4.0.6\n    ports:\n    - "6379:6379"\n    command:\n    - "redis-server"\n    - "--appendonly"\n    - "yes"\n')),(0,l.kt)("h3",{id:"volumes"},"Volumes"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Allows naming and sharing of volumes"),(0,l.kt)("li",{parentName:"ul"},"Support external volumes")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"version: '3'\nservices:\n  app-cache:\n    image: redis:4.0.6\n    volumes:\n    # Named Volume\n    - named-volume:/data\n    # Compose File Relative Path\n    - ./cache:/tmp/cache\n    # Auto-generated voume\n    - /tmp/stuff\nvolumes:\n  named-volume:\n  external-volume:\n    external: true\n")),(0,l.kt)("h3",{id:"networks"},"Networks"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"One network created by default"),(0,l.kt)("li",{parentName:"ul"},"Suppose")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  webapp:\n    image: app\n  cache:\n    image: redis\n    ports:\n    - "36379:6379"\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"In the default network",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"cache can reach web via ",(0,l.kt)("inlineCode",{parentName:"li"},"http://web:80")),(0,l.kt)("li",{parentName:"ul"},"web can reach redis via ",(0,l.kt)("inlineCode",{parentName:"li"},"redis://cache:6379")))),(0,l.kt)("li",{parentName:"ul"},"One the host machine",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"host can reach cache via ",(0,l.kt)("inlineCode",{parentName:"li"},"redis://localhost:36379")),(0,l.kt)("li",{parentName:"ul"},"host cannot reach web"))),(0,l.kt)("li",{parentName:"ul"},"Custom network can be created through ",(0,l.kt)("inlineCode",{parentName:"li"},"external: true")),(0,l.kt)("li",{parentName:"ul"},"Another example")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"version: '3'\nservices:\n  proxy:\n    image: repo/proxy\n    networks:\n    - frontend\n  app:\n    image: repo/app\n    networks:\n    - frontend\n    - backend\n  db:\n    image: redis\n    networks:\n      backend:\n        aliases:\n        - database\nnetworks:\n  frontend:\n  backend:\n    external: true\n")),(0,l.kt)("h3",{id:"varialb-substitution"},"Varialb Substitution"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Use shell environment in the Compose file"),(0,l.kt)("li",{parentName:"ul"},"Can use ",(0,l.kt)("inlineCode",{parentName:"li"},"$VAR")," or ",(0,l.kt)("inlineCode",{parentName:"li"},"${VAR}")),(0,l.kt)("li",{parentName:"ul"},"Substitute an empty string if the variable is not set")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"services:\n  proxy:\n    image: 'redis:${REDIS_VERSION}'\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"export REDIS_VERSION=4.0.5\n")),(0,l.kt)("h3",{id:"extension-fields"},"Extension Fields"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"WARNING"),": This is only for version 3.4 or higher!"),(0,l.kt)("ul",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ul"},"Reuse configuration fragments"),(0,l.kt)("li",{parentName:"ul"},"Root keys beginning with ",(0,l.kt)("inlineCode",{parentName:"li"},"x-"))),(0,l.kt)("pre",{parentName:"blockquote"},(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"version: '3.4'\nx-logging:\n  &default-logging\n  options:\n    max-size: '10m'\n    max-file: 7\n  driver: json-file\nservices:\n  web:\n    image: repo/app\n    logging: *default-logging\n  cache:\n    image: redis\n    logging: *default-logging\n"))),(0,l.kt)("h2",{id:"cli"},"CLI"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Run multiple isolated environments"),(0,l.kt)("li",{parentName:"ul"},"Parallel execution model"),(0,l.kt)("li",{parentName:"ul"},"Compose file change detection")),(0,l.kt)("h3",{id:"usage"},"Usage"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose [OPTIONS] [COMMAND] [ARGS]")),(0,l.kt)("li",{parentName:"ul"},"Connect to host by default",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Connect to remost host using ",(0,l.kt)("inlineCode",{parentName:"li"},"-H")),(0,l.kt)("li",{parentName:"ul"},"Secure connection using ",(0,l.kt)("inlineCode",{parentName:"li"},"--tls*")," options"))),(0,l.kt)("li",{parentName:"ul"},"Looks for ",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose.(yml|yaml)"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-f")," specifies the another file"))),(0,l.kt)("li",{parentName:"ul"},"Projects to represent isolated apps",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Use directory as project name"),(0,l.kt)("li",{parentName:"ul"},"Use ",(0,l.kt)("inlineCode",{parentName:"li"},"-p")," for custom name")))),(0,l.kt)("h3",{id:"commands"},"Commands"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Many generalize docker commands"),(0,l.kt)("li",{parentName:"ul"},"Two commands are introduced by Compose",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"up:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Creates networks and named volumes"),(0,l.kt)("li",{parentName:"ul"},"Builds, creates, starts, and attaches to service containers"),(0,l.kt)("li",{parentName:"ul"},"Perform change detection"))),(0,l.kt)("li",{parentName:"ul"},"down:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Remove service containers, named and default networks"),(0,l.kt)("li",{parentName:"ul"},"Leaves volume and images by default"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"config")," command: used for checking the correctness of the compose file"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"build")," command: used for building images for your application")),(0,l.kt)("h2",{id:"references"},"References"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://cloudacademy.com/learning-paths/cloud-academy-docker-in-depth-129/"},"https://cloudacademy.com/learning-paths/cloud-academy-docker-in-depth-129/"))))}c.isMDXComponent=!0}}]);